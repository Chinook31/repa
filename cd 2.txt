http://www.cbr.ru/DailyInfoWebServ/DailyInfo.asmx







&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
   ЗагрузитьКурсыВалют();	
   Сообщить("Курсы валют загружены")
КонецПроцедуры



&НаСервере
Процедура ЗагрузитьКурсыВалют()	
Прокси=WSСсылки.КурсыВалютЦБ.СоздатьWSПрокси("http://web.cbr.ru/","DailyInfo","DailyInfoSoap12");

ТилWSПараметра = Прокси.ФабрикаXDTO.Пакеты.Получить("http://web.cbr.ru/").Получить ("GetCursOnDate");
WSПараметр = Прокси.ФабрикаXDTO.Создать (ТилWSПараметра);
WSПараметр.On_Date= Текущаядата(); 

КурсыВалют = Прокси.GetCursOnDate(WSПараметр);

Для Каждого Элемент Из КурсыВалют. GetCursOnDateResult.diffgram.ValuteData.ValuteCursOnDate 
  	Цикл Валюта = СоздатьПолучитьВалюту(Элемент);
	Если Валюта <> Неопределено Тогда МенеджерКурсыВалют = РегистрыСведений.КурсыВалют.СоздатьМенеджерЗаписи();
		МенеджерКурсыВалют.Валюта = Валюта;
		МенеджерКурсыВалют.Курс = Элемент.Vcurs;
		МенеджерКурсыВалют.Период = ТекущаяДата();
		МенеджерКурсыВалют.Записать ();  
	КонецЕсли;
	КонецЦикла;
КонецПроцедуры 


&НаСервере
Функция СоздатьПолучитьВалюту(Элемент)
	Валюта = Справочники.Валюта.НайтиПоКоду(Элемент.Vcode);
	Если Валюта <> Неопределено И Валюта = Справочники.Валюта.ПустаяСсылка() Тогда
		ВалютаОбъект = Справочники.Валюта.СоздатьЭлемент();
		ВалютаОбъект.Наименование = Элемент.Vname;
		ВалютаОбъект.Код = Элемент.Vcode;
		ВалютаОбъект.Записать();
		Возврат ВалютаОбъект.Ссылка;
	ИначеЕсли ЗначениеЗаполнено(Валюта) Тогда
		Возврат Валюта;
	Иначе
		Возврат Неопределено;
	КонецЕсли;
КонецФункции



